<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>„Éë„É≥„Åè„Çì„ÇíËøΩ„Åà</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            user-select: none;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        body {
            display: flex;
            flex-direction: column; /* Á∏¶„Å´‰∏¶„Åπ„Çã */
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
        }

        /* --- ÂÖ±ÈÄö„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Çπ„Çø„Ç§„É´ --- */
        #site-nav {
            text-align: center;
            padding: 10px;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 5px;
            z-index: 100; /* ÊúÄÂâçÈù¢„Å´ */
        }

        .nav-link {
            display: inline-block;
            padding: 8px 16px;
            text-decoration: none;
            color: #555;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-link.active {
            background-color: #4385f4;
            color: white !important;
        }
        /* ------------------------------ */
        
        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: auto;
            max-height: 90vh;
            padding: 5px;
            gap: 8px;
            overflow-y: auto;
        }
        
        h1 {
            color: white;
            font-size: clamp(18px, 5vw, 36px);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
            margin-bottom: 5px;
        }
        
        .title-area {
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 15px;
            width: 100%;
        }
        
        .image-container img {
            max-width: 90vw;
            max-height: 80px;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .game-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-height: calc(100vh - 250px);
        }
        
        #gameCanvas {
            border: 3px solid white;
            background-color: #0a0a32;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 95vw;
            touch-action: none;
        }
        
        .volume-control {
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 10px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .volume-slider { width: 80px; }
        .volume-value { color: white; font-size: 10px; }

        .instructions {
            color: white;
            font-size: 11px;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }
    </style>
</head>
<body>

    <nav id="site-nav">
        <a href="index.html" class="nav-link">„É°„Ç§„É≥Ë®àÁÆóÊ©ü</a>
        <a href="chasepankun.html" class="nav-link">„Éë„É≥„Åè„Çì„ÇíËøΩ„Åà</a>
        <a href="index1.html" class="nav-link">Ver.1</a>
        <a href="index2.html" class="nav-link">Ver.2</a>
    </nav>

    <div class="container">
        <h1>„Éë„É≥„Åè„Çì„ÇíËøΩ„Åà</h1>
        <div class="title-area">
            <div class="image-container">
                <img src="images/kiyo.png" alt="„Åç„Çà„ÅÆ„Ç§„É©„Çπ„Éà">
            </div>
            <div class="volume-control">
                <div class="volume-icon">üîä</div>
                <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="70">
                <div class="volume-value"><span id="volumeValue">70</span>%</div>
            </div>
        </div>
        <div class="game-wrapper">
            <canvas id="gameCanvas"></canvas>
        </div>
        <div class="instructions">
            <p>Âãï„ÅÑ„Å¶„ÅÑ„Çã„Éë„É≥„Åè„Çì„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Çπ„Ç≥„Ç¢„Çí‰∏ä„Åí„Åæ„Åó„Çá„ÅÜ!</p>
            <p>„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Åü„Å≥„Å´„Éë„É≥„Åè„Çì„ÅØ„Çπ„Éî„Éº„Éâ„Åå‰∏ä„Åå„Çã„Çà</p>
        </div>
    </div>

    <script>
        // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„É™„É≥„ÇØ„ÇíÂà§ÂÆö
        window.addEventListener('DOMContentLoaded', () => {
            const currentFile = window.location.pathname.split("/").pop() || "index.html";
            const links = document.querySelectorAll('.nav-link');
            links.forEach(link => {
                if (link.getAttribute('href') === currentFile) {
                    link.classList.add('active');
                }
            });
        });

        // --- „Ç≤„Éº„É†„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');

        const GAME_WIDTH = 600;
        const GAME_HEIGHT = 400;

        let score = 0;
        let spriteX = GAME_WIDTH / 2;
        let spriteY = GAME_HEIGHT / 2;
        let spriteSpeed = [2, 2];
        let spriteRadius = 25;
        let spriteImage = null;
        let scaleX = 1;
        let scaleY = 1;
        let volume = 70;

        let audioContext = null;
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        function playSuccessSound() {
            try {
                const ctxAudio = initAudio();
                const now = ctxAudio.currentTime;
                const gainNode = ctxAudio.createGain();
                gainNode.gain.value = (volume / 100) * 0.3;
                gainNode.connect(ctxAudio.destination);
                const osc = ctxAudio.createOscillator();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                osc.connect(gainNode);
                osc.start(now);
                osc.stop(now + 0.1);
            } catch (e) { console.log(e); }
        }

        const img = new Image();
        img.src = 'images/pan.png';
        img.onload = () => { spriteImage = img; };

        volumeSlider.addEventListener('input', (e) => {
            volume = parseInt(e.target.value);
            volumeValue.textContent = volume;
            volumeSlider.style.background = `linear-gradient(to right, #667eea 0%, #667eea ${volume}%, #ccc ${volume}%, #ccc 100%)`;
        });

        function resizeCanvas() {
            const containerWidth = Math.min(window.innerWidth - 20, GAME_WIDTH);
            const containerHeight = Math.min(window.innerHeight - 300, GAME_HEIGHT);
            const aspectRatio = GAME_WIDTH / GAME_HEIGHT;
            let canvasWidth = containerWidth;
            let canvasHeight = containerWidth / aspectRatio;
            if (canvasHeight > containerHeight) {
                canvasHeight = containerHeight;
                canvasWidth = canvasHeight * aspectRatio;
            }
            canvas.width = Math.max(canvasWidth, 250);
            canvas.height = Math.max(canvasHeight, 166);
            scaleX = canvas.width / GAME_WIDTH;
            scaleY = canvas.height / GAME_HEIGHT;
        }

        function draw() {
            ctx.fillStyle = '#0a0a32';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            const fontSize = Math.max(16, canvas.width / 20);
            ctx.font = `bold ${fontSize}px Arial`;
            ctx.fillText(`Score: ${score}`, 15, fontSize + 10);

            const drawX = spriteX * scaleX;
            const drawY = spriteY * scaleY;
            const spriteSize = 100 * Math.min(scaleX, scaleY);

            if (spriteImage) {
                ctx.drawImage(spriteImage, drawX - spriteSize / 2, drawY - spriteSize / 2, spriteSize, spriteSize);
            } else {
                ctx.fillStyle = 'yellow';
                ctx.beginPath();
                ctx.arc(drawX, drawY, spriteRadius * Math.min(scaleX, scaleY), 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function update() {
            spriteX += spriteSpeed[0];
            spriteY += spriteSpeed[1];
            if (spriteX < 50 || spriteX > GAME_WIDTH - 50) spriteSpeed[0] *= -1;
            if (spriteY < 50 || spriteY > GAME_HEIGHT - 50) spriteSpeed[1] *= -1;
        }

        function handleClick(event) {
            const rect = canvas.getBoundingClientRect();
            let clientX = (event.touches ? event.touches[0].clientX : event.clientX);
            let clientY = (event.touches ? event.touches[0].clientY : event.clientY);
            if(event.changedTouches) {
                clientX = event.changedTouches[0].clientX;
                clientY = event.changedTouches[0].clientY;
            }
            const clickX = (clientX - rect.left) / scaleX;
            const clickY = (clientY - rect.top) / scaleY;
            const dist = Math.sqrt(Math.pow(clickX - spriteX, 2) + Math.pow(clickY - spriteY, 2));

            if (dist < 60) {
                score += 1;
                spriteX = Math.random() * (GAME_WIDTH - 100) + 50;
                spriteY = Math.random() * (GAME_HEIGHT - 100) + 50;
                spriteSpeed[0] *= 1.05;
                spriteSpeed[1] *= 1.05;
                playSuccessSound();
            }
        }

        canvas.addEventListener('mousedown', handleClick);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleClick(e); }, {passive: false});

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        gameLoop();
    </script>
</body>
</html>
